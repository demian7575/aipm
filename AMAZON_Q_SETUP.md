# Amazon Q Setup for AIPM Code Generation

## Why Amazon Q > Bedrock

**Amazon Q advantages:**
- ‚úÖ **Full repository context** - Understands entire codebase
- ‚úÖ **Follows existing patterns** - Matches your code style
- ‚úÖ **Better code quality** - Context-aware suggestions
- ‚úÖ **Understands project structure** - Knows where files go

**Bedrock limitations:**
- ‚ùå Only sees the prompt (no repo context)
- ‚ùå Generic code generation
- ‚ùå May not match project patterns

## Setup in CloudShell

### 1. Install Amazon Q CLI

```bash
# Download and install
curl -fsSL https://d3vv6lp55qjaqc.cloudfront.net/items/1P1b0z0W0c1j3e0Y3g3Y/amazon-q-cli-linux-x64.tar.gz -o q.tar.gz
tar -xzf q.tar.gz
sudo mv q /usr/local/bin/q
chmod +x /usr/local/bin/q

# Verify installation
q --version
```

### 2. Login to Amazon Q

```bash
q login
# Follow the browser authentication flow
```

### 3. Test Code Generation

```bash
cd /home/cloudshell-user/aipm

# Test with full repo context
q chat "Add a console.log to show when stories are loaded"

# Amazon Q will:
# - Analyze the entire repository
# - Understand the code structure
# - Generate contextually appropriate code
```

## Usage

### Option 1: Manual (Recommended for now)

```bash
# 1. Create branch
git checkout -b feature/my-feature

# 2. Generate code with Amazon Q
q chat "Implement: Add story search. Requirements: Search box in header, filters by title and description"

# 3. Review and commit
git add -A
git commit -m "feat: add story search"
git push -u origin feature/my-feature

# 4. Create PR
gh pr create --title "feat: Add story search" --body "Generated by Amazon Q"
```

### Option 2: Automated Script

```bash
# Run the generation script
./generate-code-with-q.sh "Add story search" "Search box in header" "feature/story-search"

# Script will:
# - Create branch
# - Run Amazon Q with full context
# - Commit and push
# - Show PR creation link
```

### Option 3: Queue-based (Future)

```bash
# Run in background (cron job)
*/5 * * * * cd /home/cloudshell-user/aipm && ./cloudshell-generate.sh

# This will:
# - Check for queued tasks from AIPM UI
# - Generate code with Amazon Q
# - Create PR automatically
```

## Comparison

### Current: Bedrock in Lambda
```javascript
// Limited context
const prompt = "Add story search";
const code = await bedrock.generate(prompt);
// Generic code, may not match patterns
```

### With Amazon Q in CloudShell
```bash
# Full repository context
q chat "Add story search"
# Amazon Q reads:
# - All existing code
# - Project structure
# - Coding patterns
# - Dependencies
# Result: High-quality, contextual code
```

## Example Workflow

### User Action
1. Click "Create PR" in AIPM
2. Fill in task details
3. Submit

### CloudShell (You)
```bash
# Check for tasks
./cloudshell-generate.sh

# Output:
# üìã Task: Add story search
# ü§ñ Amazon Q analyzing repository...
# ‚úÖ PR #149 created
```

### Result
- PR created with high-quality code
- Follows existing patterns
- Ready to review and merge

## Benefits

| Feature | Bedrock | Amazon Q |
|---------|---------|----------|
| Repository Context | ‚ùå No | ‚úÖ Full |
| Code Quality | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| Pattern Matching | ‚ùå No | ‚úÖ Yes |
| Project Understanding | ‚ùå No | ‚úÖ Yes |
| Setup Complexity | Easy | Medium |
| Cost | ~$0.01/request | Free (with subscription) |

## Recommendation

**For best results:**
1. Use **Amazon Q in CloudShell** for code generation
2. Keep **Bedrock as fallback** for when CloudShell unavailable
3. Run `./cloudshell-generate.sh` periodically (or set up cron)

## Automation (Optional)

### Set up cron job
```bash
# Edit crontab
crontab -e

# Add line to check every 5 minutes
*/5 * * * * cd /home/cloudshell-user/aipm && ./cloudshell-generate.sh >> /tmp/aipm-q.log 2>&1
```

### Or run manually when needed
```bash
# Check for pending tasks
./cloudshell-generate.sh
```

## Current Status

‚úÖ **Scripts created:**
- `generate-code-with-q.sh` - Manual code generation
- `cloudshell-generate.sh` - Queue-based automation

‚è≥ **Next steps:**
1. Login to Amazon Q: `q login`
2. Test generation: `./generate-code-with-q.sh "test" "test" "test-branch"`
3. Set up automation (optional)

## Summary

**You're right!** Amazon Q with full repository context is much better than Bedrock with just a prompt. CloudShell is the perfect place to run it.

**Current implementation:**
- ‚úÖ Bedrock works (immediate, but limited context)
- ‚úÖ Amazon Q scripts ready (better quality, needs setup)

**Recommended approach:**
- Use Amazon Q in CloudShell for best results
- Keep Bedrock as instant fallback
