#!/bin/bash

# Update progress.md with current system status
# Usage: ./bin/update-progress

set -e

# Load config
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
source "$PROJECT_ROOT/scripts/utilities/load-env-config.sh" prod

PROGRESS_FILE=".kiro/steering/progress.md"
TIMESTAMP=$(date '+%Y-%m-%d %H:%M %Z')

echo "ðŸ“ Updating progress.md..."

# Get current system status
if command -v ssh &> /dev/null && [ -f "bin/ssh-ec2" ]; then
    echo "ðŸ” Checking EC2 status..."
    
    # Try to get prod EC2 status
    PROD_IP=$(aws ec2 describe-instances \
        --instance-ids "$INSTANCE_ID" \
        --region us-east-1 \
        --query 'Reservations[0].Instances[0].PublicIpAddress' \
        --output text 2>/dev/null || echo "unknown")
    
    if [ "$PROD_IP" != "None" ] && [ "$PROD_IP" != "unknown" ]; then
        echo "âœ… Production EC2: $PROD_IP"
    fi
fi

# Update timestamp in progress.md
sed -i "s/\*\*Last Updated\*\*:.*/\*\*Last Updated\*\*: $TIMESTAMP/" "$PROGRESS_FILE"

echo "âœ… Updated timestamp in $PROGRESS_FILE"
echo ""
echo "To commit this update:"
echo "  git add $PROGRESS_FILE"
echo "  git commit -m 'Update progress timestamp'"
echo "  git push origin main"
