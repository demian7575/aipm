<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PR Link Display Test</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    button { padding: 8px 16px; margin: 5px; cursor: pointer; }
    .result { margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 3px; }
    .pr-link { color: #0366d6; text-decoration: none; }
    .pr-link:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h1>PR Link Display Test</h1>
  
  <div class="test-section">
    <h2>Test 1: Store PR Entry</h2>
    <button onclick="storePREntry()">Store Test PR Entry</button>
    <div id="store-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>Test 2: Retrieve and Display PR Entry</h2>
    <button onclick="displayPREntry()">Display PR Entry</button>
    <div id="display-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>Test 3: Clear Storage</h2>
    <button onclick="clearStorage()">Clear Test Data</button>
    <div id="clear-result" class="result"></div>
  </div>

  <script>
    const TEST_PR_ENTRY = {
      id: 'test-pr-' + Date.now(),
      storyId: 1,
      taskTitle: 'Test PR Link Display',
      repo: 'test-owner/test-repo',
      branchName: 'feature/test-pr-display',
      target: 'pull_request',
      targetNumber: 123,
      number: 123,
      type: 'pull_request',
      prUrl: 'https://github.com/test-owner/test-repo/pull/123',
      htmlUrl: 'https://github.com/test-owner/test-repo/pull/123',
      taskUrl: 'https://github.com/test-owner/test-repo/pull/123',
      threadUrl: 'https://github.com/test-owner/test-repo/pull/123',
      confirmationCode: 'TEST123',
      createTrackingCard: true,
      createdAt: new Date().toISOString()
    };

    function storePREntry() {
      const entries = JSON.parse(localStorage.getItem('aiPm.codexDelegations') || '[]');
      entries.push(TEST_PR_ENTRY);
      localStorage.setItem('aiPm.codexDelegations', JSON.stringify(entries));
      
      document.getElementById('store-result').innerHTML = `
        <strong>✓ Stored PR Entry:</strong><br>
        ID: ${TEST_PR_ENTRY.id}<br>
        PR URL: <a href="${TEST_PR_ENTRY.prUrl}" target="_blank" class="pr-link">${TEST_PR_ENTRY.prUrl}</a><br>
        Task: ${TEST_PR_ENTRY.taskTitle}
      `;
    }

    function displayPREntry() {
      const entries = JSON.parse(localStorage.getItem('aiPm.codexDelegations') || '[]');
      const testEntry = entries.find(e => e.id.startsWith('test-pr-'));
      
      if (!testEntry) {
        document.getElementById('display-result').innerHTML = '<strong>⚠ No test PR entry found. Store one first.</strong>';
        return;
      }

      document.getElementById('display-result').innerHTML = `
        <strong>✓ Retrieved PR Entry:</strong><br>
        <div style="margin-top: 10px; padding: 10px; background: white; border: 1px solid #ccc;">
          <p><strong>PR ID:</strong> ${testEntry.id}</p>
          <p><strong>Title:</strong> ${testEntry.taskTitle}</p>
          ${testEntry.prUrl ? `<p><strong>PR:</strong> <a href="${testEntry.prUrl}" target="_blank" class="pr-link">${testEntry.prUrl}</a></p>` : '<p><strong>PR:</strong> No URL</p>'}
          <p><strong>Target Branch:</strong> main</p>
          <p><strong>Created:</strong> ${new Date(testEntry.createdAt).toLocaleString()}</p>
        </div>
      `;
    }

    function clearStorage() {
      const entries = JSON.parse(localStorage.getItem('aiPm.codexDelegations') || '[]');
      const filtered = entries.filter(e => !e.id.startsWith('test-pr-'));
      localStorage.setItem('aiPm.codexDelegations', JSON.stringify(filtered));
      
      document.getElementById('clear-result').innerHTML = '<strong>✓ Test data cleared</strong>';
      document.getElementById('display-result').innerHTML = '';
      document.getElementById('store-result').innerHTML = '';
    }
  </script>
</body>
</html>
