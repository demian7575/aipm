<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kiro Live Log</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Courier New', monospace; background: #000; color: #0f0; height: 100vh; display: flex; flex-direction: column; }
    .header { background: #111; padding: 10px 15px; border-bottom: 1px solid #333; }
    .logs { flex: 1; overflow-y: auto; padding: 15px; font-size: 13px; line-height: 1.6; white-space: pre-wrap; }
    .controls { padding: 10px; background: #111; border-top: 1px solid #333; }
    button { background: #333; color: #0f0; border: 1px solid #555; padding: 8px 16px; margin-right: 10px; cursor: pointer; }
    button:hover { background: #555; }
  </style>
</head>
<body>
  <div class="header">
    <h2>ü§ñ Kiro Live Log - /tmp/kiro-cli-live.log</h2>
  </div>
  
  <div class="logs" id="logs">Loading...</div>
  
  <div class="controls">
    <button onclick="refreshLog()">üîÑ Refresh</button>
    <button onclick="toggleAutoRefresh()" id="toggleBtn">‚è∏Ô∏è Pause</button>
  </div>

  <script>
    const logsEl = document.getElementById('logs');
    const toggleBtn = document.getElementById('toggleBtn');
    let autoRefresh = true;
    let interval;

    const getBackendUrl = () => {
      if (window.CONFIG?.BACKEND_URL) {
        return window.CONFIG.BACKEND_URL;
      }
      // Default to the current host (assumes backend exposed on port 4000)
      return `${window.location.protocol}//${window.location.hostname}:4000`;
    };

    async function fetchLog() {
      try {
        const response = await fetch(`${getBackendUrl()}/api/kiro-live-log`);
        const data = await response.json();
        logsEl.textContent = data.content || 'Log file is empty';
        logsEl.scrollTop = logsEl.scrollHeight;
      } catch (error) {
        logsEl.textContent = `Error: ${error.message}`;
      }
    }

    function refreshLog() {
      fetchLog();
    }

    function toggleAutoRefresh() {
      if (autoRefresh) {
        clearInterval(interval);
        toggleBtn.textContent = '‚ñ∂Ô∏è Resume';
        autoRefresh = false;
      } else {
        startAutoRefresh();
        toggleBtn.textContent = '‚è∏Ô∏è Pause';
        autoRefresh = true;
      }
    }

    function startAutoRefresh() {
      interval = setInterval(fetchLog, 1000);
    }

    // Initialize
    fetchLog();
    startAutoRefresh();
  </script>
</body>
</html>
