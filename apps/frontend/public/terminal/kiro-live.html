<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kiro Live Log</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Courier New', monospace; background: #000; color: #0f0; height: 100vh; display: flex; flex-direction: column; }
    .header { background: #111; padding: 10px 15px; border-bottom: 1px solid #333; }
    .logs { flex: 1; overflow-y: auto; padding: 15px; font-size: 13px; line-height: 1.6; white-space: pre-wrap; }
    .controls { padding: 10px; background: #111; border-top: 1px solid #333; }
    .command-input { padding: 10px; background: #111; border-top: 1px solid #333; display: flex; gap: 10px; }
    .command-input input { flex: 1; background: #000; color: #0f0; border: 1px solid #333; padding: 8px; font-family: 'Courier New', monospace; }
    .command-input input:focus { outline: none; border-color: #0f0; }
    button { background: #333; color: #0f0; border: 1px solid #555; padding: 8px 16px; margin-right: 10px; cursor: pointer; }
    button:hover { background: #555; }
    button:disabled { background: #222; color: #666; cursor: not-allowed; }
  </style>
</head>
<body>
  <div class="header">
    <h2>ü§ñ Kiro Live Log - /tmp/kiro-cli-live.log</h2>
  </div>
  
  <div class="logs" id="logs">Loading...</div>
  
  <div class="controls">
    <button onclick="refreshLog()">üîÑ Refresh</button>
    <button onclick="toggleAutoRefresh()" id="toggleBtn">‚è∏Ô∏è Pause</button>
  </div>

  <div class="command-input">
    <input type="text" id="commandInput" placeholder="Enter Kiro command..." />
    <button onclick="sendCommand()" id="sendBtn">Send</button>
  </div>

  <script>
    const logsEl = document.getElementById('logs');
    const toggleBtn = document.getElementById('toggleBtn');
    const commandInput = document.getElementById('commandInput');
    const sendBtn = document.getElementById('sendBtn');
    let autoRefresh = true;
    let interval;

    async function fetchLog() {
      try {
        const response = await fetch('http://44.220.45.57/api/kiro-live-log');
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const data = await response.json();
        logsEl.textContent = data.content || 'Log file is empty';
        logsEl.scrollTop = logsEl.scrollHeight;
      } catch (error) {
        logsEl.textContent = `Error fetching log: ${error.message}\n\nFallback content:\n[${new Date().toISOString()}] Kiro CLI live log viewer\n[${new Date().toISOString()}] Waiting for log updates...`;
      }
    }

    async function sendCommand() {
      const command = commandInput.value.trim();
      if (!command) return;
      
      sendBtn.disabled = true;
      sendBtn.textContent = 'Sending...';
      
      try {
        const response = await fetch('http://44.220.45.57:8081/kiro/v4/enhance', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            idea: command,
            callbackUrl: 'http://example.com'
          })
        });
        
        if (response.ok) {
          commandInput.value = '';
          // Refresh log to show new command output
          setTimeout(fetchLog, 1000);
        } else {
          throw new Error(`HTTP ${response.status}`);
        }
      } catch (error) {
        alert(`Command failed: ${error.message}`);
      } finally {
        sendBtn.disabled = false;
        sendBtn.textContent = 'Send';
      }
    }

    // Enter key to send command
    commandInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendCommand();
    });

    function refreshLog() {
      fetchLog();
    }

    function toggleAutoRefresh() {
      if (autoRefresh) {
        clearInterval(interval);
        toggleBtn.textContent = '‚ñ∂Ô∏è Resume';
        autoRefresh = false;
      } else {
        startAutoRefresh();
        toggleBtn.textContent = '‚è∏Ô∏è Pause';
        autoRefresh = true;
      }
    }

    function startAutoRefresh() {
      interval = setInterval(fetchLog, 1000);
    }

    // Initialize
    fetchLog();
    startAutoRefresh();
  </script>
</body>
</html>
